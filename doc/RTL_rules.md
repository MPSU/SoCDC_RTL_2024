# Правила проведения и оценки RTL-трека

## Содержание

- [Правила проведения](#правила-проведения)
- [Правила проверки результатов](#правила-проверки-результатов)
- [Методы измерения критериев](#методы-измерения-критериев)
  - [Измерение Fmax](#измерение-fmax)
  - [Измерение Area](#измерение-area)
  - [Измерение Latency](#измерение-latency)
  - [Измерение Bandwidth](#измерение-bandwidth)
- [Правила выполнения задания](#правила-выполнения-задания)

## Правила проведения

- Выполнение задания начинается `19-го апреля` после завершения организационной части.
- Решение команды должно быть загружено в репозиторий не позднее `14:00 21-го апреля`. 
- Для проверки на достоверность результатов будет принят последний на `14:00` коммит, лежащий в ветке `master`. 
- В течение `двух часов` жюри проверяет работы команд, после чего на награждении объявляются результаты соревнования.

## Правила проверки результатов

> В проверке результата используются только HDL-файлы, расположенные в **директории rtl**. Все файлы дизайнов, расположенные в других директориях в проверке учитываться не будут. **Пожалуйста, следите, где сохраняете файлы.**  

> Для проверки достоверности результатов проводится **симуляция нетлиста** после синтеза в `Vivado`. В том случае, если он не проходит тест, то **результаты не будут засчитаны**.

Решение команды проверяется по **четырем** критериям. Каждый из критериев команды могут измерить самостоятельно в процессе решения задачи.  

- **Максимальная тактовая частота (`Fmax`)** (больше — лучше)
- **Количество занимаемых ресурсов FPGA (`Area`)** (меньше — лучше)
- **Средняя задержка завершения транзакции (`Latency`)** (меньше — лучше)
- **Пропускная способность (`Bandwidth`)** (больше — лучше)

**Каждый критерий оценивается отдельно**, и, в соответствии с занятым местом, каждая команда получает балл за критерий.  

Команда, занявшая по определенному критерию первое место, получает **максимальный балл, равный количеству команд**. Все остальные команды получают балл относительно того, насколько хуже их результат относительно первого места. Если результат хуже в три раза, то команда получает треть баллов от максимума. При совпадении результатов у двух и более команд они получают одинаковый балл.  

В таблице ниже **для примера** приведен список из 4 команд. Для каждого критерия указано измеренное значение, в скобках баллы, полученные командой, за критерий.

| Команда | Fmax | Area | Latency | Bandwidth | Итоговый балл | Место в общем зачёте |
| ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| Команда А | 75  (3) | 1800 (2) | 12 (2) | 2250 (3) | 8.4 | 2 | 
| Команда B | 100 (4) | 1200 (3) | 24 (1) | 3000 (4) | 9.7 | 1 | 
| Команда С | 50  (2) | 3600 (1) | 8  (3) | 1500 (2) | 7.1 | 4 | 
| Команда D | 25  (1) | 900  (4) | 6  (4) | 750  (1) | 7.8 | 3 | 

**Итоговый балл для команды рассчитывается по формуле**, учитывающей баллы, набранные по каждому критерию. Формула отражает приоритет критериев с точки зрения выполнения задания и дает итоговый результат. Для **примера** итоговые баллы приведены в таблице.  

**Формула расчёта итогового балла:**  
$Итоговый$ $балл = (1.0 * F_{max}) + (0.5 * Area) + (1.0 * Latency) + (0.8 * Bandwidth) $

**Пример** расчёта для команды А из таблицы выше: 
$Итоговый$ $балл = (1.0 * 3) + (0.5 * 2) + (1.0 * 2) + (0.8 * 3) = 8.4 $

Распределение команд в общем зачете происходит в соответствии с итоговым баллом. Команда, получившая максимальный итоговый балл, занимает первое место.

## Методы измерения критериев

Каждый из критериев, как было сказано выше, команда может получить самостоятельно в процессе выполнения задания.

- `Максимальная тактовая частота (Fmax)` измеряется **при выполнении стадии Implementation в САПР Vivado**. Смотри [инструкцию по запуску скриптов](./scripts.md) и [по работе в VIVADO GUI](./vivado_manual.md).
- `Количество занимаемых ресурсов FPGA (Area)` измеряется **при выполнении стадии Implementation в САПР Vivado**. Смотри [инструкцию по запуску скриптов](./scripts.md) и [по работе в VIVADO GUI](./vivado_manual.md).
- `Средняя задержка завершения транзакции (Latency)` измеряется **при выполнении теста в симуляции**. Смотри [инструкцию](./Questa_How_To.md).
- `Пропускная способность (Bandwidth)` измеряется **при выполнении теста в симуляции**. Смотри [инструкцию](./Questa_How_To.md).

### Измерение Fmax

Как было сказано выше, измерение производится в `САПР Vivado` согласно [инструкции](./vivado_manual.md). Также значение максимальной тактовой частоты можно получить, запустив скрипт ([инструкция](./scripts.md)). В таблицу заносится **результат в МГц**.  

### Измерение Area

Итоговая метрика по площади считается как интегральная характеристика. Потому что в результате имплементации в `Vivado` занимаемая площадь выражается не в миллиметрах квадратных, а значениях по нескольким категориям. Это количество используемых `LUT, FF, BRAM, DSP`.  
  
В рамках хакатона предлагается считать интегральную характеристику, которая будет объединять все ресурсы через весовые коэффициенты.  
  
Причем, что важно, считается не количество доступных `LUT` и `FF`, а количество `slice`. Это конфигурационные блоки `Xilinx`, которые состоят из `LUT` и `FF`. А значит, количеством заполненных `slice` определяется процент использования кристалла.  
  
Коэффициенты связаны с соотношением доступных ресурсов **в конкретной FPGA**, которая используется в хакатоне.  
  
Это **Artix-7 200T. xc7a200tfbg484-1**. В таблице ниже указаны доступные ресурсы для данной FPGA.
| Slice  | BRAM   | DSP    |
| ------ | ------ | ------ |
| 33 650 | 365    | 740    |

**Итоговая формула выглядит следующим образом:**
$$Area = Slice + 92.2 * BRAM + 45.5 * DSP$$
 
**Важно**. Итоговую метрику по площади команды могут посчитать вручную или получить результат из **скрипта** ([инструкция](./scripts.md#сбор-метрик)).


### Измерение Latency

Измерение `latency` производится после запуска симуляции согласно [инструкции](./Questa_How_To.md), и в репорте можно посмотреть результат.  
  
**Важно!!!** Итоговый `latency` считается при **закрытом запуске** теста через `CI`, см. [инструкцию](./CI.md). Именно результат **закрытого** тестирования учитывается жюри. Однако закрытый тест не дает логов, поэтому для отладки дизайна необходимо **самостоятельно** запустить тест.  
  
Как понятно из [задания](/README.md#задание), у каждой транзакции существует поле **приоритета**, которое указывает важность его обработки. От решения команд требуется **сократить** время обработки **приоритетных** транзакций по сравнению с остальными. И данное требование отражается в расчёте `Latency`.  

`Latency` рассчитывается как **среднее время задержки обработки от всех транзакций в тесте**. Однако при подсчете среднего значения больший вклад в среднюю задержку вносят транзакции с высоким приоритетом. Формула расчёта `Latency` выглядит следующим образом:

$$Latency = \frac{\left( \sum_{k=1}^n (Priority_k + 1) * (Time_k) \right)}{n}  $$
где:
$Priority$ — приоритет транзакции;
$Time$ — измеренное время завершения пакета **в тактах**;
$n$ — количество пакетов.
 
### Измерение Bandwidth

Измерение `Bandwidth` производится после запуска симуляции согласно [инструкции](./Questa_How_To.md), и в репорте можно посмотреть результат.   

**Важно!!!** Итоговый `Bandwidth` считается при **закрытом запуске** теста через `CI`, см. [инструкцию](./CI.md). Именно результат **закрытого** тестирования учитывается жюри. Но закрытый тест не дает логов, поэтому для отладки дизайна самостоятельно запускайте тест. 

`Bandwidth` (измеряется в Mбит/сек) — это количество пакетов, переданных по всех каналам, умноженное на разрядность данных и поделенное на время передачи. Чем это значение больше, тем быстрее справляется интерконнект.

## Правила выполнения задания

При решении задачи:
- **Нельзя** изменять выбранную модель `ПЛИС`.
- **Нельзя** изменять настройки синтеза и имплементации в `Vivado` и использовать другой `САПР`.
- **Нельзя** использовать закрытые `IP-core`.
- **Нельзя** менять порты `top-level` модуля.
- **Нельзя** менять параметры, которые уже прописаны в проекте, но **можно** добавлять новые.
